ARG DOCKER_OS_IMAGE=
ARG DOCKER_OS_TAG=
FROM ${DOCKER_OS_IMAGE}:${DOCKER_OS_TAG}
ARG DEVEL_CONTAINER_FLAVOUR=
ARG BUILDER_DIR=/image-build
ARG SERVICES_DIR=${BUILDER_DIR}/services
ARG FLAVOURS_DIR=${BUILDER_DIR}/flavours
ARG USER_UID=
ARG USER_GID=
ENV DEVEL_CONTAINER_FLAVOUR=${DEVEL_CONTAINER_FLAVOUR}
RUN mkdir -p ${BUILDER_DIR}
COPY *.sh ${BUILDER_DIR}
RUN mkdir -p ${SERVICES_DIR}
COPY services/*.sh ${SERVICES_DIR}
RUN mkdir -p ${FLAVOURS_DIR}
COPY flavours/*.sh ${FLAVOURS_DIR}
RUN cd ${BUILDER_DIR} && \
    ./install.sh
RUN cd ${BUILDER_DIR} && \
    sed -i "s/__USER_UID__/${USER_UID}/g" env-build.sh && \
    sed -i "s/__USER_GID__/${USER_GID}/g" env-build.sh && \
    ./setup.sh
RUN rm -rf ${BUILDER_DIR}
ENTRYPOINT "__INIT_SCRIPT__"
